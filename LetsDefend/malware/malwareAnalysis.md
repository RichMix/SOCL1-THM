# What Should a Malware Analyst Know

Malware analysis is a subject that may seem easy from the outside, but in essence, it requires expertise in many aspects. 
While malware analysis is a separate field in its own right, some Tier 3 SOC Analysts (Subject Matter Experts) focus their careers in malware analysis only. 
Although malware analysis is a separate field, it is often used by Security Analysts in their daily work routines.

In order to be able to analyze malicious software correctly and successfully, it is necessary to have the basics in many subjects. 
Let's take a look at these topics.

Operating System Fundamentals and Architecture
Since malware runs on operating systems, malware analysts should have a solid understanding and knowledge of the operating systems.

https://www.technologyuk.net/computing/computer-software/operating-systems/images/monolithic_os_kernel.gif
Malware often takes advantage of the features offered by the operating system, increasing its privileges, making discovery and ensuring persistence. 
To give an example on Windows operating systems, 
malicious software uses the features of the operating system such as Task Scheduler, Services, Registry to ensure persistence.

In addition to the features of the operating system, API, Syscalls, Memory Architecture and lower level issues are also important for successful malware analysis. 
We will focus on these topics more on the "Static Malware Analysis" training.


## Assembly Language & Programming

If you ever developed software before, have you wondered what happens when you compile the programming languages you write? 
Or have you ever wondered how the processors run multiple programming languages when there are many programming languages.

Processors only understand 0s and 1s. All data, except 0 and 1 are meaningless to the processors. 
When you compile any program in languages ​​such as, C/C++, Python, Java, Ruby, Go etc. -
compilers translate the codes you write into 0s and 1s that the processor can understand. 
When you start a program, these 0s and 1s are sent to the processor over the memory to run.
The lowest level programming language you can see is Assembly if we do not consider 0s and 1s. Each instruction has a direct 0 and 1 counterpart.
When you compile a program written in C, it is first translated to Assembly language and then to 0s and 1s.

Compiled malware can be easily converted into the Assembly language. However, converting from Assembly language to the next level is not very easy and accurate, so analyses are usually made through Assembly language. 
Software that translates machine codes into Assembly language is called "Disassembler".
In the static code analysis training, we will also focus on the basics of the "Assembly" Language.


## Network Protocols and Fundamentals

Malware often exhibits network activity in order to hijack information, connect to a command and control server, or download second payloads.
Understanding these network traffics while analyzing malware is extremely important for us to understand the purpose of the malware.
For this reason, malware analysts should have basic network knowledge.


## Cryptography

Many technologies make use of cryptography to provide security. It is also used by attackers for purposes such as complicating, preventing detection and preventing access.
Popular ransomware uses cryptography nowadays to encrypt files and prevent access to files without paying a ransom.
We often encounter cryptography during malware analysis.

Questions
Which encryption type ransomwares uses?
asymmetric

What is the encryption type frequently used by ransomware-type malware?

Note: Enter the abbreviation of the answer.
aes

What is the name of the software that compiles of the written codes?
compiler

According to Wikipedia, in what year did assembly language first appear?
1947

What is the name of the software that translates machine code into assembly language?
disassembler

Dynamic Analysis Example Using AnyRun
You can take advantage of sandbox services / products to quickly analyze malware.

AnyRun is an interactive sandbox that you can use when you want to analyze malware quickly.

AnyRun has options for paid or free use. If you want to take advantage of it for free, all your analysis is visible to others, therefore we do not recommend that you upload files that may contain personal data to AnyRun. In addition, the free plan has restrictions such as usage time.

How can we use AnyRun for our malware analysis, what kind of outputs we can get, let's examine it together.

Let's download the malware with hash 80b51e872031a2befeb9a0a13e6fc480 to analyze via AbuseCH (Click here to download).

We have to click on the "+" (New Task) button on the left menu to upload the malware we downloaded.


Let's upload the file we want to analyze on the screen that opens with the help of the "Choose a file" button. After the file is uploaded, we can determine the parameters such as which operating system we want to run the malware and 32/64 bit of operating system to use. After determining these, we open our sandbox with the help of the "Run" button at the bottom right of the screen that opens.

When our machine is turned on, we run the malicious software we uploaded to see it's activities.

Some malware stays dormant for a certain period of time before performing its malicious activities, making analysis difficult. Let's allow time for the malware to perform its activities, during this time, let's examine the AnyRun interface together.


From this area, you can use the operating system interactively.
Here is a list of processes in this section. From here, you can easily see which childprocesses the malware you run has.
In this area there is network and files events.
This section contains details of the process.
Let's examine these outputs.

First, let's examine the process events of the malware in the section marked "2" in the image above.


The malware we run manually seems to have created 2 child processes. 
One of them is schtasks.exe, which is run to ensure persistence on the system by creating a schedule task and the other is the process specified as "AgentTesla" malware by AnyRun.

When we click on Processes, information about this process is displayed in panel number 4. 
Let's examine the details of all processes respectively.

Since the process named "WinRAR.exe" is created when we extract the malware from the archive file to run it, we will not examine this process.

When we click on the process with ID 2680, information about this process is listed on panel number 4.


With the "More Info" button on this panel, a page with detailed information about the process is opened. 
When we want to reach detailed information, we can use this section.

When the process information with 2680 ID is examined, the malware:

Uses Task Scheduler,
Writes a program to the file system which compile time is too old,
Writes many files to the user directory

When we examine the process with ID 2616, we see that it is schtasks.exe belonging to Task Scheduler.

When we examine the "Command Line" parameters, we see that it creates a schedule task named "Updates\neHneiobyhcrJJ". 
The configurations for this schedule task are in the file "tmp5383.tmp".

When we examine the schedule task configuration file named tmp5383.tmp, we see that the program named "neHneiobyhcrJJ.exe" will run.

When we examine the process with ID 3140:

This malware is recognized by AnyRun as AgentTesla,
Steals credentials,
Creating files in the user directory

When we examine the network connections made from panel number 3, we see that malware connects to smtp.godforeu.com.

With the help of the button on the right of the panel, we can examine the incoming/outgoing data.

When the network activities of the malware are examined, we find that malware exfiltrates data with the SMTP protocol.

If you want to examine, you can reach the analysis made here (Click here).

# 29 Addresses to Analyze Malware Faster
We constantly spend time analyzing malware.

We have listed 29 addresses that can be useful for blue team members to use time more effectively:

Anlyz
Any.run
Comodo Valkyrie
Cuckoo
Hybrid Analysis
Intezer Analyze
SecondWrite Malware Deepview
Jevereg
IObit Cloud
BinaryGuard
BitBlaze
SandDroid
Joe Sandbox
AMAaaS
IRIS-H
Gatewatcher Intelligence
Hatching Triage 
InQuest Labs
Manalyzer
SandBlast Analysis
SNDBOX
firmware
opswat
virusade
virustotal
malware config
malware hunter team
virscan 
jotti

